<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<head>
		<meta http-equiv="content-type" content="text/html;charset=utf-8" />
		<title>diff & patch - xanpeng</title>
		<link rel="stylesheet" type="text/css" href="/css/style.css" />
		<link rel="stylesheet" type="text/css" href="/css/syntax.css" />
	</head>

	<body>
		<div id="wrapper">
			<div id="content">
				<h2>diff & patch</h2>
				<div class="cnt">
					<p><a href="http://jungels.net/articles/diff-patch-ten-minutes.html">Ten minute guide to diff and patch</a><br/>
<a href="http://www.linuxtutorialblog.com/post/introduction-using-diff-and-patch-tutorial">Introduction: Using diff and patch (tutorial)</a><br/>
<a href="http://www.gnu.org/software/diffutils/manual/html_mono/diff.html">Comparing and Merging Files</a></p>

<p>"Comparing and Merging Files" 的笔记:</p>

<hr />

<h1>diff</h1>

<p>TIPS:<br/>
- 用 <code>diff3</code> 比较 3 个文件的差异, 用 <code>sdiff</code> side-by-side 地显示文件差异.<br/>
- "-E" 或 "--ignore-tab-expansion" 忽略 tab 和空格之间的差异.<br/>
- "-b" 或 "--ignore-space-change" 忽略行尾的空格, 并认为连续的空白符都是一样的. 比 "-E" 强.<br/>
- "-w" 或 "--ignore-all-space" 忽略一行中所有的空白差异. 如果一行有空格, 另一行甚至没有空格, 都认为无差异.<br/>
- "-B" 或 "--ignore-blank-lines" 忽略空白行差异.<br/>
- "-i" 或 "--ignore-case" 忽略大小写差异.<br/>
- "-I regexp" 或 "--ignore-matching-lines=regexp" 忽略正则表达式的匹配行.<br/>
- "-q" 或 "--brief" 只显示是否有差别, 不显示具体信息.</p>

<p><strong>Hunks</strong></p>

<p>一组连续的差异行称为 hunks. gnu diff 的原则: 使所有 hunks 的大小最小, 尽量找出更多的匹配行.</p>

<p><strong>Output Formats</strong></p>

<p><a href="http://www.gnu.org/software/diffutils/manual/html_mono/diff.html#Detailed%20Normal">Normal Format</a>: <code>diff f1, f2</code>, "l<strong>a</strong>r, f<strong>c</strong>t, r<strong>d</strong>l"</p>

<p><a href="http://www.gnu.org/software/diffutils/manual/html_mono/diff.html#Context%20Format">Context Format</a>: <code>diff -C #lines(--context[=#lines], -c, 默认3行) f1, f2</code></p>

<p><a href="http://www.gnu.org/software/diffutils/manual/html_mono/diff.html#Detailed%20Unified">Unified Format</a>: <code>diff -U #lines(--unified[=#lines], -u, 默认3行) f1, f2</code><br/>
目前仅 gnu diff 支持这种格式, 为了 patch works properly, 一般需要至少3行的 context.</p>

<p>Unified Format 的详细说明:</p>

<blockquote><p>--- from-file from-file-modification-time<br/>
+++ to-file to-file-modification-time</p></blockquote>

<p>比较的两个文件.</p>

<blockquote><p>@@ from-file-range to-file-range @@<br/>
 line-from-either-file<br/>
 line-from-either-file...</p></blockquote>

<p>hunk. 由多个这种格式的 hunks 构成这两个文件的 diff. 其中,<br/>
+ 表示在 from(first) file 中加入行<br/>
- 表示在 from(first) file 中移除行</p>

<p>示例:</p>

<blockquote><p>--- lao   2002-02-21 23:30:39.942229878 -0800<br/>
+++ tzu   2002-02-21 23:30:50.442260588 -0800<br/>
@@ -1,7 +1,6 @@  -> 表示比较 from file L1 开始的7行和 to file L1 开始的6行.<br/>
-The Way that can be told of is not the eternal Way;<br/>
-The name that can be named is not the eternal name.<br/>
 The Nameless is the origin of Heaven and Earth;<br/>
-The Named is the mother of all things.<br/>
+The named is the mother of all things.<br/>
+<br/>
 Therefore let there always be non-being,<br/>
   so we may see their subtlety,<br/>
 And let there always be being,<br/>
@@ -9,3 +8,6 @@  -> 表示比较 from file L9 开始的3行和 to file L8 开始的6行.<br/>
 The two are the same,<br/>
 But after they are produced,<br/>
   they have different names.<br/>
+They both may be called deep and profound.<br/>
+Deeper and more profound,<br/>
+The door of all subtleties!</p></blockquote>

<p>"-p" 显示区别所在的函数, 更多见<a href="http://www.gnu.org/software/diffutils/manual/html_mono/diff.html#C%20Function%20Headings">这里</a>.</p>

<p><a href="http://www.gnu.org/software/diffutils/manual/html_mono/diff.html#Side%20by%20Side%20Format">side by side format</a>: <code>diff -y(--side-by-side) -W #cols(--width=#cols) f1 f2</code></p>

<hr />

<h1>patch</h1>

<p>selecting the patch input format:<br/>
-c, --context: context diff.<br/>
-e, --ed: ed script.<br/>
-n, --normal: normal diff.<br/>
-u, --unified: unified diff.</p>

<p>applying patches with changed white space:<br/>
-I, --ignore-white-space: 忽略空白符的差异.</p>

<p>applying reversed patches:<br/>
-R, --reverse: patch 会去交换每一个 hunk 的 from 和 to 部分. 这适合于错误地执行 <code>diff new old</code> 产生的 patch 或者要恢复刚刚打上的 patch.</p>

<p>to be continued...</p>

					--EOF--
				</div>
				<div id="disqus_thread"></div>
				<script type="text/javascript">
				  (function() {
				   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				   dsq.src = 'http://xanpeng.disqus.com/embed.js';
				   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
				  })();
				</script>
				<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=lzyyblog">comments powered by Disqus.</a></noscript>
			</div>
	</body>
</html>

