<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<head>
		<meta http-equiv="content-type" content="text/html;charset=utf-8" />
		<title>chroot - xanpeng</title>
		<link rel="stylesheet" type="text/css" href="/css/style.css" />
		<link rel="stylesheet" type="text/css" href="/css/syntax.css" />
	</head>

	<body>
		<div id="wrapper">
			<div id="content">
				<h2>chroot</h2>
				<div class="cnt">
					<p>来了解一下 chroot(<a href="http://en.wikipedia.org/wiki/Chroot">1</a>, <a href="http://unix.stackexchange.com/questions/105/chroot-jail-what-is-it-and-how-do-i-use-it">2</a>), <code>chroot --help</code> 得到:</p>

<blockquote><p>Usage: chroot NEWROOT [COMMAND...]
  or:  chroot OPTION
Run COMMAND with root directory set to NEWROOT.</p>

<pre><code>  --help     display this help and exit
  --version  output version information and exit
</code></pre>

<p>If no command is given, run ``${SHELL} -i'' (default: /bin/sh). --> 一般指向 /bin/bash</p>

<p>Report bugs to <a href="&#x6d;&#x61;&#x69;&#x6c;&#x74;&#x6f;&#x3a;&#98;&#117;&#x67;&#45;&#x63;&#x6f;&#114;&#x65;&#x75;&#x74;&#105;&#x6c;&#x73;&#64;&#103;&#x6e;&#117;&#x2e;&#111;&#114;&#103;">&#98;&#x75;&#x67;&#45;&#x63;&#111;&#x72;&#x65;&#117;&#116;&#x69;&#x6c;&#115;&#64;&#x67;&#110;&#117;&#46;&#111;&#114;&#103;</a>.</p></blockquote>

<p>简单地说, chroot 就是把根目录切换到 NEWROOT, 如果 COMMAND 没有指定, 默认执行的是 /bin/bash, 不过需要注意这里的 "/bin/bash" 实际上是原来的 NEWROOT/bin/bash.<br/>
所以需要在 NEWROOT 下<a href="http://www.antionline.com/showthread.php?t=156511">准备 chroot 环境</a>, 比如 bash 程序以及它需要的链接库等, 如果没有, 都会报错:</p>

<blockquote><p>chroot: cannot run command `/bin/bash': No such file or directory</p></blockquote>

<p>这是一个极具<a href="http://serverfault.com/questions/162362/chroot-fails-cannot-run-command-bin-bash-no-such-file-or-directory">迷惑性的错误</a>, 你会以为 /bin/bash 真的不存在, 但实际上只是依赖的库不存在而已.</p>

<p>chroot 使用了 syscall <a href="http://linux.die.net/man/2/chroot">chroot</a> 和 <a href="http://linux.die.net/man/2/chdir">chdir</a>, chdir 是拿来修改当前工作目录的, <a href="http://linux.die.net/man/2/chroot">chroot</a> 则估计是<a href="http://dyverin.blogspot.com/2008/09/chroot.html">修改某个关联 root 目录的环境变量</a>.</p>

<p>那么 chroot 有什么用处? 容易想到, 可以用来保护原来的目录树, 也可以用来把 NEWROOT 当成一个 sandbox, 更多看<a href="http://www.ibm.com/developerworks/cn/linux/l-cn-chroot/">这个</a>.</p>

<p>如果你通过 terminal 进入一个系统, 你如何知晓当前是执行在 chroot 环境下? <a href="http://unix.stackexchange.com/questions/14345/how-do-i-tell-im-running-in-a-chroot">这里</a>提供了一个方法, 通过查看根目录 "/" 的 inode 号(<code>ls -di /</code>)来验证. 不过如果我们跑到原始的 "/" 下面 <code>chroot .</code> (不知 chroot 是否会检查这个情况?), 那就不能用这个方法了.</p>

					--EOF--
				</div>
				<div id="disqus_thread"></div>
				<script type="text/javascript">
				  (function() {
				   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				   dsq.src = 'http://xanpeng.disqus.com/embed.js';
				   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
				  })();
				</script>
				<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=lzyyblog">comments powered by Disqus.</a></noscript>
			</div>
	</body>
</html>

