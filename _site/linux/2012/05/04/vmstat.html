<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<head>
		<meta http-equiv="content-type" content="text/html;charset=utf-8" />
		<title>vmstat - xanpeng</title>
		<link rel="stylesheet" type="text/css" href="/css/style.css" />
		<link rel="stylesheet" type="text/css" href="/css/syntax.css" />
	</head>

	<body>
		<div id="wrapper">
			<div id="content">
				<h2>vmstat</h2>
				<div class="cnt">
					<p><em>本文基于"<a href="http://www.opsers.org/base/linux-monitoring-tools-vmstat-command-explanation.html">Linux监控工具vmstat命令详解</a>".</em></p>

<p>vmstat是一个查看虚拟内存（Virtual Memory）使用状况的工具, 可以通过vmstat发现系统中的瓶颈.</p>

<p><strong>vmstat详解</strong></p>

<pre><code>vmstat [-a] [-n] [-S unit] [delay [ count]]
vmstat [-s] [-n] [-S unit]
vmstat [-m] [-n] [delay [ count]]
vmstat [-d] [-n] [delay [ count]]
vmstat [-p disk partition] [-n] [delay [ count]]
vmstat [-f]
vmstat [-V]
</code></pre>

<p>-a: 显示活跃和非活跃内存<br/>
-f: 显示从系统启动至今的fork数量<br/>
-m: 显示slabinfo<br/>
-n: 只在开始时显示一次各字段名称<br/>
-s: 显示内存相关统计信息及多种系统活动数量<br/>
-d: 显示磁盘相关统计信息<br/>
-p: 显示指定磁盘分区统计信息<br/>
-S: 使用指定单位显示。参数有 k, K, m, M, 分别代表1000, 1024, 1000000, 1048576字节(byte). 默认单位为K(1024 bytes)<br/>
-V: 显示vmstat版本信息<br/>
delay: 刷新时间间隔。如果不指定，只显示一条结果<br/>
count: 刷新次数。如果不指定刷新次数，但指定了刷新时间间隔，这时刷新次数为无穷</p>

<p><strong>字段说明</strong><br/>
<em>为了排版对齐, 使用'_'代替空格.</em></p>

<pre><code># vmstat 3 // 每3秒显示一次结果  
procs -----------memory---------- ---swap-- -----io---- -system-- -----cpu------  
 r__b___swpd___free___buff___cache___si___so____bi____bo____in___cs_us_sy_id_wa_st  
 0__0______0_3571512__42456_202324____0____0_____4_____2__195__238__0__0_99__0__0  
 0__0______0_3571600__42456_202328____0____0_____0_____0__502__635__0__0_100__0__0  
</code></pre>

<p><strong>procs(进程)</strong><br/>
r: 运行队列中进程数量, 这个值也可以判断是否需要增加CPU (长期大于1)<br/>
b: 等待IO的进程数量</p>

<p><strong>Memory(内存)</strong><br/>
swpd: 使用虚拟内存大小<br/>
--<em>注意: 如果swpd的值不为0, 但是SI, SO的值长期为0, 这种情况不会影响系统性能.</em><br/>
free: 空闲物理内存大小<br/>
buff: 用作缓冲的内存大小<br/>
cache: 用作缓存的内存大小<br/>
--<em>注意: 如果cache的值大的时候, 说明cache处的文件数多, 如果频繁访问到的文件都能被cache处, 那么磁盘的读IO bi会非常小。</em></p>

<p><strong>Swap </strong><br/>
si: swap-in, 每秒从交换区写到内存的大小, 由磁盘调入内存<br/>
so: swap-out, 每秒写入交换区的内存大小, 由内存调入磁盘  <br/>
--<em>注意: 内存够用的时候, 这2个值都是0, 如果这2个值长期大于0时, 系统性能会受到影响, 磁盘IO和CPU资源都会被消耗. 有些朋友看到空闲内存(free)很少的或接近于0时, 就认为内存不够用了, 不能光看这一点, 还要结合si和so, 如果free很少, 但是si和so也很少(大多时候是0), 那么不用担心, 系统性能这时不会受到影响的.</em></p>

<p><strong>IO </strong>
bi: 每秒读取的块数<br/>
bo: 每秒写入的块数<br/>
--<em>注意: 随机磁盘读写的时候, 这2个值越大(如超出1024k), 能看到CPU在IO等待的值也会越大.</em></p>

<p><strong>系统</strong><br/>
in: 每秒中断数, 包括时钟中断<br/>
cs: 每秒上下文切换数<br/>
--<em>注意: 上面2个值越大, 会看到由内核消耗的CPU时间会越大.</em></p>

<p><strong>CPU(以百分比表示)</strong><br/>
us: 用户进程执行时间百分比(user time)<br/>
--<em>注意: us的值比较高时, 说明用户进程消耗的CPU时间多, 但是如果长期超50%的使用, 那么我们就该考虑优化程序算法或者进行加速.</em><br/>
sy: 内核系统进程执行时间百分比(system time)<br/>
--<em>注意: sy的值高时, 说明系统内核消耗的CPU资源多, 这并不是良性表现, 我们应该检查原因.</em><br/>
wa: IO等待时间百分比<br/>
--<em>注意: wa的值高时, 说明IO等待比较严重, 这可能由于磁盘大量作随机访问造成, 也有可能磁盘出现瓶颈(块操作).</em><br/>
id: 空闲时间百分比</p>

					--EOF--
				</div>
				<div id="disqus_thread"></div>
				<script type="text/javascript">
				  (function() {
				   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				   dsq.src = 'http://xanpeng.disqus.com/embed.js';
				   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
				  })();
				</script>
				<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=lzyyblog">comments powered by Disqus.</a></noscript>
			</div>
	</body>
</html>

