<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
	<head>
		<meta http-equiv="content-type" content="text/html;charset=utf-8" />
		<title>C++实现线程安全的Singleton - xanpeng</title>
		<link rel="stylesheet" type="text/css" href="/css/style.css" />
		<link rel="stylesheet" type="text/css" href="/css/syntax.css" />
	</head>

	<body>
		<div id="wrapper">
			<div id="content">
				<h2>C++实现线程安全的Singleton</h2>
				<div class="cnt">
					<p>如何用C++实现线程安全的单例模式(singleton)，本文汇总这方面的讨论，包括DCL(double-checked-locking)、meyers singleton和采用pthread_once()的方案，并最终决定在今后<strong>选择pthread_once()方案</strong>。</p>

<p>在现在的我看来，陈硕的muduo是一个宝库，从中可以学到C++、网络编程、分布式应用、多线程服务程序等方面的实践知识。muduo不是朝夕之功，而且其背后隐藏的价值不下于代码本身，陈硕自2008年始就写作了多篇相关博文，很值得学习，比如“<a href="http://files.cppblog.com/Solstice/multithreaded_server.pdf">多线程服务器的常用编程模型</a>”。此文提到了线程安全的Singleton实现，我想到去年曾了解这个话题，这次再遇，打算记录下来。</p>

<h3>Double-Checked Locking Pattern</h3>

<p>DCLP不是线程安全的，因为可能有乱序执行的影响，Meyers的<a href="http://www.aristeia.com/Papers/DDJ_Jul_Aug_2004_revised.pdf">这篇文章</a>有讨论。</p>

<p>Liquid error: No such file or directory - pygmentize</p>

<h3>Meyers Singleton</h3>

<p>该实现使用了lazy initialization，看起来线程安全，但实际上不是的。</p>

<p>Liquid error: No such file or directory - pygmentize</p>

<p>因为实际上编译器类似于如此处理(看<a href="http://stackoverflow.com/questions/1661529/is-meyers-implementation-of-singleton-pattern-thread-safe">这个链接</a>，里面有不错的扩展资料)：</p>

<p>Liquid error: No such file or directory - pygmentize</p>

<h3>pthread_once()</h3>

<p>这个方案被stackoverflow上一些人以及陈硕支持，下面的代码来自于陈硕的博文。</p>

<p>Liquid error: No such file or directory - pygmentize</p>

					--EOF--
				</div>
				<div id="disqus_thread"></div>
				<script type="text/javascript">
				  (function() {
				   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
				   dsq.src = 'http://xanpeng.disqus.com/embed.js';
				   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
				  })();
				</script>
				<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript=lzyyblog">comments powered by Disqus.</a></noscript>
			</div>
	</body>
</html>

