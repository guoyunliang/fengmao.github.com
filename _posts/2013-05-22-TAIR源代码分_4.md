---
title:   [Tair源代码分析<4>]
layout: post
category: tair
---
<p align=center><img src=/images/tair-3/t1.png width=401></p>
##2.7  Tair Server心跳机制
<pre class="prettyprint lang-cc">
</pre>
<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js?lang=cc&skin=sunburst"></script>
###写在最前面

Tair源代码分析<3>还没有写完，主要原因是数据迁移部分有一些细节没有搞透彻。我想换一个角度来看看。从Tair Server与Tair Config Server之间的心跳机制的角度来分析Tair Server。

##2.7  Tair Server心跳机制

Tair的存储节点与CS通过心跳保持联系。存储节点通过节点获取当前对照表信息，获取整个集群迁移状态信息，获取CS的状态信息等。CS通过与存储节点的心跳来检测存储节点是否处于可用状态，或从异常状态恢复过来，收集数据迁移信息等。

###2.7.1 心跳请求包与返回包

Tair Server与CS之间的心跳请求包如下图所示。
<p align=center><img src=/images/2013-05-22/heartbeat_packet.png width=605></p>

在请求包中，Tair Server向CS发送的信息包括Server ID, 描述迁移状态的migrate_version(存储在loop_count中), 存储节点中对照表版本config_version, Server的状态，area配额信息。在心跳的
